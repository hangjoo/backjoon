## 문제

N×N개의 수가 N×N 크기의 표에 채워져 있다. (x1, y1)부터 (x2, y2)까지 합을 구하는 프로그램을 작성하시오. (x, y)는 x행 y열을 의미한다.

예를 들어, N = 4이고, 표가 아래와 같이 채워져 있는 경우를 살펴보자.

![image-20210303170554263](source/image-20210303170554263.png)

여기서 (2, 2)부터 (3, 4)까지 합을 구하면 3+4+5+4+5+6 = 27이고, (4, 4)부터 (4, 4)까지 합을 구하면 7이다.

표에 채워져 있는 수와 합을 구하는 연산이 주어졌을 때, 이를 처리하는 프로그램을 작성하시오.

---

## 입력

첫째 줄에 표의 크기 N과 합을 구해야 하는 횟수 M이 주어진다. (1 ≤ N ≤ 1024, 1 ≤ M ≤ 100,000) 둘째 줄부터 N개의 줄에는 표에 채워져 있는 수가 1행부터 차례대로 주어진다. 다음 M개의 줄에는 네 개의 정수 x1, y1, x2, y2 가 주어지며, (x1, y1)부터 (x2, y2)의 합을 구해 출력해야 한다. 표에 채워져 있는 수는 1,000보다 작거나 같은 자연수이다. (x1 ≤ x2, y1 ≤ y2)

---

## 출력

총 M줄에 걸쳐 (x1, y1)부터 (x2, y2)까지 합을 구해 출력한다.

---

## 풀이

```python
import sys

n, m = map(int, sys.stdin.readline().split())
nums = [list(map(int, sys.stdin.readline().split())) for _ in range(n)]
nums_sum = [[0 for _ in range(n + 1)] for _ in range(n + 1)]

for x in range(1, n + 1):
    for y in range(1, n + 1):
        nums_sum[x][y] = nums[x - 1][y - 1] + nums_sum[x - 1][y] + nums_sum[x][y - 1] - nums_sum[x - 1][y - 1]

for _ in range(m):
    x1, y1, x2, y2 = map(int, sys.stdin.readline().split())
    ret = nums_sum[x2][y2] - nums_sum[x1 - 1][y2] - nums_sum[x2][y1 - 1] + nums_sum[x1 - 1][y1 - 1]
    sys.stdout.write(str(ret) + "\n")
```

주어진 숫자가 쓰여진 N x N 크기의 표와 두 개의 좌표를 가지고 한 좌표에서 다른 좌표까지의 숫자 합을 구하는 문제입니다.

시작 좌표(x1, y1)에서 도착 좌표(x2, y2)까지 하나하나 더하는 과정은 제일 간단하지만 합을 구해야 하는 횟수 M의 최댓값은 100,000이고 표의 최대 사이즈는 1024 x 1024이므로 매번 덧셈 연산을 통해 구하게 된다면 최대 연산 횟수는 1024 x 1024 x 100,000으로 주어진 시간 제한 1초를 초과하게 됩니다.

따라서 적은 연산 횟수로 합을 구하는 방법을 구현하여 매번 합을 구하는 과정의 시간을 단축시켜야 합니다.

이를 위해 (1, 1)에서 해당 좌표(x, y)까지의 합을 사용하도록 합니다.

<img src="source/그림1-1614758151689.png" alt="그림1" style="zoom:50%;" />

좌측은 주어진 N x N 크기의 표이고 우측은 주어진 표를 가지고 (1, 1)에서 해당 좌표(x, y)까지의 합을 기록한 표 입니다. 이 때 해당 좌표까지(x, y)의 합은 (x, y)에 적혀있는 숫자와 (x-1, y)까지의 합과 (x, y-1)까지의 합을 더한 뒤 (x-1, y-1)까지의 합이 중복되어 더해져 있으므로 빼서 구할 수 있습니다. 첫번째 행과 첫번째 열을 추가하여 0으로 사용한 이유는 N x N 크기로 합을 기록할 경우 1행과 1열에 대해서는 x-1 혹은 y-1의 인덱스가 존재하지 않기 때문에 예외처리를 해줘야하는데 0으로된 행과 열을 추가함으로써 따로 예외처리를 하지 않고 바로 구할 수 있기 위함입니다.

이렇게 (1, 1)부터 (x, y)까지의 합을 기록한 데이터를 가지고 (x1, y1)부터 (x2, y2)까지의 합을 구하는 것은 코드 13번 줄처럼 간단히 3번의 연산을 통해 구할 수 있습니다.

추가로 최대 100,000회의 입출력을 처리해야 하기 때문에 input과 print 대신 readline과 write를 통해 입출력을 처리했습니다.

처음에 2차원 리스트에 숫자를 저장한 뒤 리스트 슬라이싱과 sum을 통해 합을 구하도록 구현했는데 시간 초과를 겪고 합을 구하는 과정을 단순화 시키는 방법이 필요하다 판단되어 합을 간단하게 만드는 방법에 대해 오랫동안 고민한 문제였습니다.